<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>IRT Tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="IRT-NLME_PRO_Tutorial_files/libs/clipboard/clipboard.min.js"></script>
<script src="IRT-NLME_PRO_Tutorial_files/libs/quarto-html/quarto.js"></script>
<script src="IRT-NLME_PRO_Tutorial_files/libs/quarto-html/popper.min.js"></script>
<script src="IRT-NLME_PRO_Tutorial_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="IRT-NLME_PRO_Tutorial_files/libs/quarto-html/anchor.min.js"></script>
<link href="IRT-NLME_PRO_Tutorial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="IRT-NLME_PRO_Tutorial_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="IRT-NLME_PRO_Tutorial_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="IRT-NLME_PRO_Tutorial_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="IRT-NLME_PRO_Tutorial_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#set-up" id="toc-set-up" class="nav-link active" data-scroll-target="#set-up">Set up</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#explore-data" id="toc-explore-data" class="nav-link" data-scroll-target="#explore-data">Explore data</a></li>
  <li><a href="#additional-data-cleaning-and-wrangling" id="toc-additional-data-cleaning-and-wrangling" class="nav-link" data-scroll-target="#additional-data-cleaning-and-wrangling">Additional data cleaning and wrangling</a></li>
  <li><a href="#explore-clean-data" id="toc-explore-clean-data" class="nav-link" data-scroll-target="#explore-clean-data">Explore clean data</a></li>
  </ul></li>
  <li><a href="#irt-modeling" id="toc-irt-modeling" class="nav-link" data-scroll-target="#irt-modeling">IRT Modeling</a>
  <ul class="collapse">
  <li><a href="#load-scale" id="toc-load-scale" class="nav-link" data-scroll-target="#load-scale">Load scale</a></li>
  <li><a href="#create-and-run-item-response-model-base-model" id="toc-create-and-run-item-response-model-base-model" class="nav-link" data-scroll-target="#create-and-run-item-response-model-base-model">Create and run item-response model (Base Model)</a></li>
  <li><a href="#review-item-parameters" id="toc-review-item-parameters" class="nav-link" data-scroll-target="#review-item-parameters">Review item parameters</a></li>
  </ul></li>
  <li><a href="#nlme-modeling-of-psi" id="toc-nlme-modeling-of-psi" class="nav-link" data-scroll-target="#nlme-modeling-of-psi">NLME Modeling of PSI</a>
  <ul class="collapse">
  <li><a href="#diagnostics" id="toc-diagnostics" class="nav-link" data-scroll-target="#diagnostics">Diagnostics</a></li>
  <li><a href="#psi-vs.-covariates" id="toc-psi-vs.-covariates" class="nav-link" data-scroll-target="#psi-vs.-covariates">PSI vs.&nbsp;Covariates</a></li>
  <li><a href="#add-age-as-a-continuous-covariate-on-baseline-psi-in-run3" id="toc-add-age-as-a-continuous-covariate-on-baseline-psi-in-run3" class="nav-link" data-scroll-target="#add-age-as-a-continuous-covariate-on-baseline-psi-in-run3">Add age as a continuous covariate on baseline PSI in run3</a></li>
  <li><a href="#vpcs" id="toc-vpcs" class="nav-link" data-scroll-target="#vpcs">VPCs</a>
  <ul class="collapse">
  <li><a href="#total-score-prediction-corrected" id="toc-total-score-prediction-corrected" class="nav-link" data-scroll-target="#total-score-prediction-corrected">Total score prediction corrected</a></li>
  <li><a href="#categorical-prediction-corrected" id="toc-categorical-prediction-corrected" class="nav-link" data-scroll-target="#categorical-prediction-corrected">Categorical prediction corrected</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">IRT Tutorial</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="set-up" class="level1">
<h1>Set up</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gc()</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(piraid)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggh4x)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xpose)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="st">"../data"</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>nonmem_dir <span class="ot">&lt;-</span> <span class="st">"../models"</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>output_dir <span class="ot">&lt;-</span> <span class="st">"../outputs"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>Some links to the study details from which these data were taken from are as follows.</p>
<ul>
<li>https://clinicaltrials.gov/study/NCT00081796?tab=table</li>
<li>https://www.sanofi.com/assets/dotcom/content-app/clinical-studies/pharma/Letter-L/EFC6089_summary.pdf</li>
</ul>
<p>Note that the data includes only control arm data. We will first do some data management to get the data ready for exploratory data analyses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load data and perform some data wrangling (add grouping, add numeric columns for categorical variables)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(data_dir, <span class="st">"EQLQ_Clean_2004_23JUN2025.csv"</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stringsAsFactors =</span> F, <span class="at">na.string=</span><span class="fu">c</span>(<span class="st">"."</span>,<span class="st">"NA"</span>,<span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(UID, ID, <span class="at">ITEM=</span>FLAG, TIME, TAFR, DV, <span class="fu">everything</span>())  <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">STUDYN =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(NCT)),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">SEXN =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(SEX)),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">ECOG =</span> <span class="fu">ifelse</span>(ECOG<span class="sc">==</span><span class="st">"0"</span>, <span class="dv">0</span>, <span class="fu">ifelse</span>(ECOG<span class="sc">==</span><span class="st">"1"</span>, <span class="dv">1</span>, <span class="cn">NA</span>)),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">MENOSN =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(MENOS)),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">CHEMO =</span> <span class="fu">ifelse</span>(CHEMO<span class="sc">==</span><span class="st">"Y"</span>, <span class="dv">1</span>, <span class="fu">ifelse</span>(CHEMO<span class="sc">==</span><span class="st">"N"</span>, <span class="dv">0</span>, <span class="cn">NA</span>)),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">SURGERY =</span> <span class="fu">ifelse</span>(SURGERY<span class="sc">==</span><span class="st">"Y"</span>, <span class="dv">1</span>, <span class="fu">ifelse</span>(SURGERY<span class="sc">==</span><span class="st">"N"</span>, <span class="dv">0</span>, <span class="cn">NA</span>)),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">RADIO =</span> <span class="fu">ifelse</span>(RADIO<span class="sc">==</span><span class="st">"Y"</span>, <span class="dv">1</span>, <span class="fu">ifelse</span>(RADIO<span class="sc">==</span><span class="st">"N"</span>, <span class="dv">0</span>, <span class="cn">NA</span>)),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">ERS =</span> <span class="fu">ifelse</span>(ERS<span class="sc">==</span><span class="st">"Positive"</span>,<span class="dv">1</span>, <span class="fu">ifelse</span>(ERS<span class="sc">==</span><span class="st">"Negative"</span>, <span class="dv">0</span>, <span class="cn">NA</span>)),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">PGRS =</span> <span class="fu">ifelse</span>(PGRS<span class="sc">==</span><span class="st">"Positive"</span>,<span class="dv">1</span>, <span class="fu">ifelse</span>(PGRS<span class="sc">==</span><span class="st">"Negative"</span>, <span class="dv">0</span>, <span class="cn">NA</span>)),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">MHDEPRESSION =</span> <span class="fu">ifelse</span>(MHDEPRESSION<span class="sc">==</span><span class="st">"Y"</span>, <span class="dv">1</span>, <span class="fu">ifelse</span>(MHDEPRESSION<span class="sc">==</span><span class="st">"N"</span>, <span class="dv">0</span>, <span class="cn">NA</span>)),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">MDANXIETY =</span>  <span class="fu">ifelse</span>(MDANXIETY<span class="sc">==</span><span class="st">"Y"</span>, <span class="dv">1</span>, <span class="fu">ifelse</span>(MDANXIETY<span class="sc">==</span><span class="st">"N"</span>, <span class="dv">0</span>, <span class="cn">NA</span>)),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">ITMGRP =</span> <span class="fu">ifelse</span>(ITEM <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">"Physical Function"</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(ITEM <span class="sc">%in%</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>, <span class="st">"Role Function"</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(ITEM <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">25</span>), <span class="st">"Cognitive Function"</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(ITEM <span class="sc">%in%</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">24</span>, <span class="st">"Emotional Function"</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(ITEM <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">26</span>,<span class="dv">27</span>), <span class="st">"Social Function"</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(ITEM <span class="sc">%in%</span> <span class="dv">8</span><span class="sc">:</span><span class="dv">19</span>, <span class="st">"Symptoms"</span>, </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(ITEM <span class="sc">%in%</span> <span class="dv">28</span>, <span class="st">"Financial Difficulties"</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(ITEM <span class="sc">%in%</span> <span class="dv">29</span><span class="sc">:</span><span class="dv">30</span>, <span class="st">"Global Health Status"</span>, <span class="cn">NA</span>)))))))),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">ITMGRPN =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(ITMGRP)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="explore-data" class="level2">
<h2 class="anchored" data-anchor-id="explore-data">Explore data</h2>
<p>The purpose of the first set of data explorations is to plan data cleaning steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All items all timepoints</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat,<span class="fu">aes</span>(<span class="at">x=</span>TIME, <span class="at">y=</span>DV)) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span>ID), <span class="at">color=</span><span class="st">"grey"</span>, <span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ITEM, <span class="at">scales=</span><span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Item Score"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Time (Wk)"</span>) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check data points per time</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>tabdat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(TIME, ITEM) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">N=</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(N), TIME, ITEM)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check data points per time (just filtering one item to check sample size over time)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>tabdat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ITEM<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(TIME, ITEM) <span class="sc">%&gt;%</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">N=</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(N), TIME, ITEM) </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tabdat, <span class="fu">aes</span>(<span class="at">x=</span>TIME, <span class="at">y=</span>N)) <span class="sc">+</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>  </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The major part of the datapoints are within -1 week through 100 days. Let’s use data upto 1 year only. We will also remove items financial difficulty (28) and global score (29 and 30). Also, we convert time in days to weeks. Keep only one timepoint per patient and ITEM per week.</p>
</section>
<section id="additional-data-cleaning-and-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="additional-data-cleaning-and-wrangling">Additional data cleaning and wrangling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter up to 1 year data </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ITEM <span class="sc">&lt;</span> <span class="dv">28</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TIME <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">7</span>, TIME <span class="sc">&lt;=</span> <span class="dv">365</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WEEK =</span> <span class="fu">floor</span>(TIME<span class="sc">/</span><span class="dv">7</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, WEEK, ITEM) <span class="sc">%&gt;%</span>       </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OID=</span>ID, <span class="at">ID =</span><span class="fu">as.numeric</span>(<span class="fu">factor</span>(OID)), <span class="at">DAY=</span>TIME) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, DAY, <span class="at">TIME=</span>WEEK, ITEM, <span class="fu">everything</span>(), <span class="sc">-</span>TIME) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID, TIME, ITEM)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Remove time points where items are missing per ID and TIME (keeping)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>rmvdat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, TIME) <span class="sc">%&gt;%</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">NITEM =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NITEM <span class="sc">!=</span> <span class="dv">27</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtered data </span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>datN <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(dat, rmvdat, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"TIME"</span>))</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Check removed data</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(rmvdat, <span class="at">caption=</span><span class="st">"List of ignored/removed data points"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>List of ignored/removed data points</caption>
<thead>
<tr class="header">
<th style="text-align: right;">ID</th>
<th style="text-align: right;">TIME</th>
<th style="text-align: right;">NITEM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td style="text-align: right;">13</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">18</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">18</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">18</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">19</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">19</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">22</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">26</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">28</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">28</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">30</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="odd">
<td style="text-align: right;">31</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td style="text-align: right;">34</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">34</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">34</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">36</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">36</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">37</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">37</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">37</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">37</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">37</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="even">
<td style="text-align: right;">37</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: right;">39</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">39</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="even">
<td style="text-align: right;">40</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">40</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">41</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">42</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">44</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">44</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">48</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">48</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">50</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">52</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: right;">52</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">52</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">52</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="odd">
<td style="text-align: right;">53</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">53</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">54</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">54</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">54</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">54</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">57</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">60</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">62</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td style="text-align: right;">65</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">67</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">70</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">70</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">74</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">74</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">75</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">75</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">76</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">77</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">77</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="odd">
<td style="text-align: right;">78</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">78</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">78</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">78</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">79</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">80</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">81</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">81</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">82</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">85</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">88</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td style="text-align: right;">88</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">90</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">91</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">91</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">91</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">91</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">91</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">94</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">94</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">94</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">95</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">95</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">95</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">95</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="even">
<td style="text-align: right;">95</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">95</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">22</td>
</tr>
<tr class="even">
<td style="text-align: right;">95</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="odd">
<td style="text-align: right;">98</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">98</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">101</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">103</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">104</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">104</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">107</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="even">
<td style="text-align: right;">108</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">109</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">109</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">109</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">111</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">112</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">116</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">119</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">120</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">121</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">122</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="odd">
<td style="text-align: right;">123</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">123</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">123</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">123</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">127</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">128</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">132</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">136</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">137</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">138</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">140</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">140</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">140</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">143</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">143</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">143</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">151</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">151</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">152</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">153</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">153</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">153</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">153</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">153</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">153</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">156</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">157</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="odd">
<td style="text-align: right;">157</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">159</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">159</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">160</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">160</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">161</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">162</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">163</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">163</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">164</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">165</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">167</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">168</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">168</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">170</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">172</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">173</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">174</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">175</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">175</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">176</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">177</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">178</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">179</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">179</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">179</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">179</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: right;">179</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">181</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">181</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="odd">
<td style="text-align: right;">181</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">181</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">181</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">183</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">183</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">186</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">186</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">187</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="odd">
<td style="text-align: right;">187</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">190</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">190</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">190</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">191</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">192</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">194</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td style="text-align: right;">196</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">197</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: right;">197</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">197</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: right;">198</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">199</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">11</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(rmvdat<span class="sc">$</span>ID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 115</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check N IDs</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(datN<span class="sc">$</span>ID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 194</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write full data version</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(datN, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.path</span>(data_dir, <span class="st">"Analysis_Data_Full.csv"</span>), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F, <span class="at">na=</span><span class="st">"."</span>, <span class="at">quote=</span>F) </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="do">## filter columns only for nonmem</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>datnm1 <span class="ot">&lt;-</span> datN <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, TIME, DAY, ITEM, DV)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>datnm2 <span class="ot">&lt;-</span> datN <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, TIME, DAY, ITEM, DV, AGE, MENOSN, LESION1, ECOG,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                          CHEMO, SURGERY, RADIO, ERS, PGRS, <span class="at">MHDEPRES=</span>MHDEPRESSION,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">MDANXIET=</span>MDANXIETY, WEIGHT, PFS, ITMGRPN)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Write only nm data version</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(datnm1,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.path</span>(data_dir, <span class="st">"Analysis_Data_nm.csv"</span>),</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F, <span class="at">na=</span><span class="st">"."</span>, <span class="at">quote=</span>F)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Write only nm data version</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(datnm2,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>          <span class="fu">file.path</span>(data_dir, <span class="st">"Analysis_Data_nm_wCov.csv"</span>),</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F, <span class="at">na=</span><span class="st">"."</span>, <span class="at">quote=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="explore-clean-data" class="level2">
<h2 class="anchored" data-anchor-id="explore-clean-data">Explore clean data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All data</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datN,<span class="fu">aes</span>(<span class="at">x=</span>TIME, <span class="at">y=</span>DV)) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span>ID), <span class="at">color=</span><span class="st">"grey"</span>, <span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ITEM, <span class="at">scales=</span><span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Item Score"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Time (Wk)"</span>) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="irt-modeling" class="level1">
<h1>IRT Modeling</h1>
<p>We will use piraid library (Check https://github.com/UUPharmacometrics/piraid for more details).</p>
<p>Also, review the following references to learn more about pharmacometrics IRT modeling.</p>
<ul>
<li>https://pmc.ncbi.nlm.nih.gov/articles/PMC5915608/</li>
<li>https://www.page-meeting.org/?abstract=8869</li>
<li>https://pubmed.ncbi.nlm.nih.gov/28247193/</li>
</ul>
<section id="load-scale" class="level2">
<h2 class="anchored" data-anchor-id="load-scale">Load scale</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare scale using piraid function and our data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># scale &lt;- create_scale_from_df(dat)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># save_scale(scale, "EORTC_QOLE30_auto.yaml")</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># scale</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># load scale with piraid </span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># this scale was manually prepared</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>scale <span class="ot">=</span> <span class="fu">load_scale</span>(<span class="st">"EORTC_QOLE27.yaml"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Check data </span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">check_data</span>(dat, scale)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The dataset is in agreement with the scale definition </code></pre>
</div>
</div>
</section>
<section id="create-and-run-item-response-model-base-model" class="level2">
<h2 class="anchored" data-anchor-id="create-and-run-item-response-model-base-model">Create and run item-response model (Base Model)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model file creation </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">irt_model</span>(scale) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_dataset</span>(<span class="fu">file.path</span>(data_dir, <span class="st">"Analysis_Data_nm.csv"</span>), <span class="at">use_path =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Initial estimates for the item parameters</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>item_prms <span class="ot">=</span> <span class="fu">estimate_item_parameters</span>(model, <span class="st">"all-baseref"</span>) </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> model <span class="sc">%&gt;%</span> <span class="fu">update_parameters</span>(., item_prms) </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="do">### Only need to save the first time this is run (else it will be overwritten)</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Save model as nonmem file</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># save_model_code(model, file.path(nonmem_dir, "run1.mod"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run nonmem model using PsN: execute run1.mod -clean=5</p>
</section>
<section id="review-item-parameters" class="level2">
<h2 class="anchored" data-anchor-id="review-item-parameters">Review item parameters</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read estimated parameters from run1</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>item_prms <span class="ot">&lt;-</span> <span class="fu">read_item_parameters_from_nmtab</span>(model, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">file.path</span>(nonmem_dir, <span class="st">"irt_tab1"</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ICCs from run1</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">plot_iccs</span>(model)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>P1<span class="sc">$</span>data<span class="sc">$</span>item  <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">":"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st"> "</span>, P1<span class="sc">$</span>data<span class="sc">$</span>item)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>P1 <span class="sc">+</span> ggh4x<span class="sc">::</span><span class="fu">facet_wrap2</span>(<span class="sc">~</span>item, <span class="at">ncol=</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="sc">-</span><span class="fl">2.75</span>, <span class="st">"pt"</span>),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x.bottom =</span> <span class="fu">element_text</span>(),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y.left =</span> <span class="fu">element_text</span>(),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.box=</span><span class="st">"horizontal"</span>) <span class="sc">+</span> </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot Information Content from ICCs from run1</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>iteminfo <span class="ot">&lt;-</span> <span class="fu">calculate_population_item_information</span>(model, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">var=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">item =</span> <span class="fu">fct_reorder</span>(item, information)) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Group =</span> <span class="fu">sub</span>(<span class="st">":.*"</span>, <span class="st">""</span>, item))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>             </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>iteminfo, <span class="fu">aes</span>(<span class="at">x=</span>item, <span class="at">y=</span>information, <span class="at">fill=</span>Group)) <span class="sc">+</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_col</span>(<span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>       <span class="fu">ylab</span>(<span class="st">"Information"</span>) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>       <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span> </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>       <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">6</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>P2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="nlme-modeling-of-psi" class="level1">
<h1>NLME Modeling of PSI</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To create a new model (run2), first fix all IRT parameters to run1 estimates</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> model <span class="sc">%&gt;%</span> <span class="fu">update_parameters</span>(., item_prms) <span class="sc">%&gt;%</span> <span class="fu">fix_all_item_parameters</span>(.)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Save updated model with fixed item parameters as run2 for NLME</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Only need to save the first time this is run (else it will be overwritten)</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># save_model_code(model, file.path(nonmem_dir, "run2.mod"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will now perform NLME modeling with IRT-predicted PSI (latent variable, disease state) change over time. We will add the following linear time effect model in run2. We will use the simplest additive random effect model. Other types of models can be evaluated, too. Also, we will change $TABLE FILE names to irt_tab2 and prob_tab2 manually.</p>
<p><span class="math display">\[  BasePSI = THETA(109) + ETA(1) \]</span> <span class="math display">\[ TMSLP = THETA(110) + ETA(2) \]</span> <span class="math display">\[ PSI = BasePSI + TMSLP*TIME \]</span></p>
<p>Now, run execute run2.mod -clean=5 using PsN Check summary of model output, i.e., parameter estimates, using sumo run2.lst</p>
<section id="diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="diagnostics">Diagnostics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.path</span>(nonmem_dir, <span class="st">"irt_tab2"</span>),</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">skip=</span><span class="dv">1</span>, <span class="at">header=</span>T, <span class="at">sep=</span><span class="fu">c</span>(<span class="st">""</span>, <span class="st">","</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.path</span>(nonmem_dir, <span class="st">"prob_tab2"</span>),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">skip=</span><span class="dv">1</span>, <span class="at">header=</span>T, <span class="at">sep=</span><span class="fu">c</span>(<span class="st">""</span>, <span class="st">","</span>))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Forgot to output covariates in nonmem model so just merging here</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">full_join</span>(df1, df2) <span class="sc">%&gt;%</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">full_join</span>(., datnm2)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">icc_plots</span>(model, df, <span class="at">items_per_page=</span><span class="dv">2</span>, <span class="at">resample_psi=</span><span class="cn">TRUE</span>, <span class="at">samples=</span><span class="dv">10</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[4]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[5]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[6]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[7]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[8]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[9]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[10]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[11]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[12]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[13]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[14]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_marginal_probability</span>(model, <span class="at">simdata=</span>df1, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-10-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="psi-vs.-covariates" class="level2">
<h2 class="anchored" data-anchor-id="psi-vs.-covariates">PSI vs.&nbsp;Covariates</h2>
<p>Let’s visualize PSI changes over time and as a function of covariates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PSI vs. TIME</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>df, <span class="fu">aes</span>(<span class="at">x=</span>TIME, <span class="at">y=</span>PSI)) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span>ID)) <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">"Time (Wk)"</span>) <span class="sc">+</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">ylab</span>(<span class="st">"PSI"</span>) <span class="sc">+</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme_bw</span>() </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>P3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Baseline PSI vs. continuous covariates </span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>plotdat <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TIME<span class="sc">==</span><span class="dv">0</span>, ITEM<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">gather</span>(<span class="fu">c</span>(<span class="st">"AGE"</span>, <span class="st">"LESION1"</span>, <span class="st">"WEIGHT"</span>), <span class="at">key=</span><span class="st">"key"</span>, <span class="at">value=</span><span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>P4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>plotdat, <span class="fu">aes</span>(<span class="at">x=</span>value, <span class="at">y=</span>PSI)) <span class="sc">+</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>       <span class="fu">ylab</span>(<span class="st">"PSI"</span>) <span class="sc">+</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>       <span class="fu">facet_wrap</span>(<span class="sc">~</span>key, <span class="at">scales=</span><span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme_bw</span>()</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>P4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Baseline PSI vs. categorical covariates</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>plotdat <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">gather</span>(<span class="fu">c</span>(<span class="st">"CHEMO"</span>, <span class="st">"SURGERY"</span>, <span class="st">"RADIO"</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"ERS"</span>, <span class="st">"PGRS"</span>, <span class="st">"MHDEPRES"</span>, <span class="st">"MDANXIET"</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"MENOSN"</span>, <span class="st">"PFS"</span>), <span class="at">key=</span><span class="st">"key"</span>, <span class="at">value=</span><span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>P5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>plotdat, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(value), <span class="at">y=</span>PSI)) <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>       <span class="fu">ylab</span>(<span class="st">"PSI"</span>) <span class="sc">+</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>       <span class="fu">facet_wrap</span>(<span class="sc">~</span>key, <span class="at">scales=</span><span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme_bw</span>()</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>P5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check correlations between AGE, WEIGHT, and LESION1</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>corr <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">cor</span>(df <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TIME<span class="sc">==</span><span class="dv">0</span>, ITEM<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(AGE,LESION1,WEIGHT)), <span class="dv">2</span>) </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>corr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          AGE LESION1 WEIGHT
AGE      1.00    0.04  -0.08
LESION1  0.04    1.00   0.05
WEIGHT  -0.08    0.05   1.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Only very weak correlations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-age-as-a-continuous-covariate-on-baseline-psi-in-run3" class="level2">
<h2 class="anchored" data-anchor-id="add-age-as-a-continuous-covariate-on-baseline-psi-in-run3">Add age as a continuous covariate on baseline PSI in run3</h2>
<p>update_inits run2.mod run2.lst -output_model=run3.mod</p>
<p>Based on the review of covariate plots, let’s test addition of age as a covarite on baseline PSI (linear model). Lowest age is 30 in the dataset. We will input dataset to Analysis_Data_nm_wCov.csv in run2. Now, we will update run3.mod PSI model manually.</p>
<p><span class="math display">\[ BasePSI = THETA(109) + ETA(1) \]</span> <span class="math display">\[ BasePSIAGE = BasePSI * (1 + THETA(111)*(AGE-30)) \]</span> <span class="math display">\[ TMSLP = THETA(110) + ETA(2) \]</span> <span class="math display">\[ PSI = BasePSIAGE + TMSLP*TIME \]</span></p>
<p>Upon running run3, dOFV from run2 = -2.67 ~ not significant. We could evaluate other covariates, too. For the purpose of this tutorial, consider run2 as the final model.</p>
</section>
<section id="vpcs" class="level2">
<h2 class="anchored" data-anchor-id="vpcs">VPCs</h2>
<section id="total-score-prediction-corrected" class="level3">
<h3 class="anchored" data-anchor-id="total-score-prediction-corrected">Total score prediction corrected</h3>
<p>Run VPC using command vpc run2vpc.mod -flip_comments -samples=500 -dir=vpc2 -predcorr</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>vpcdat <span class="ot">&lt;-</span> xpose<span class="sc">::</span><span class="fu">vpc_data</span>(xpdb_ex_pk, </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">psn_folder=</span><span class="st">"../models/vpc2"</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">psn_bins=</span>T)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">vpc</span>(vpcdat, <span class="at">smooth =</span>T, <span class="at">type=</span><span class="st">"alr"</span>) <span class="sc">+</span> </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time (Wk)"</span>) <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>P1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="categorical-prediction-corrected" class="level3">
<h3 class="anchored" data-anchor-id="categorical-prediction-corrected">Categorical prediction corrected</h3>
<p>Run VPC using command vpc run2vpc.mod -flip_comments -samples=500 -dir=vpc2.1 -predcorr -levels=0,1,2,3,4</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorical</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>vpcdat <span class="ot">&lt;-</span> xpose<span class="sc">::</span><span class="fu">vpc_data</span>(xpdb_ex_pk, <span class="at">vpc_type =</span> <span class="st">"categorical"</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">psn_folder=</span><span class="st">"../models/vpc2.1"</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">psn_bins=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error in jh_timelimit() : could not find function "jh_timelimit"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> <span class="fu">vpc</span>(vpcdat, <span class="at">smooth =</span>T, <span class="at">type=</span><span class="st">"alr"</span>) <span class="sc">+</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Time (Wk)"</span>) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>P2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="IRT-NLME_PRO_Tutorial_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>